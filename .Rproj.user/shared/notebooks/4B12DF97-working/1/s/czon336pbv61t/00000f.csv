"0",""
"0","# Merge df_corp with full state names"
"0","df_corp2 <- left_join(df2, state_lookup, by = ""STATE_CODE"")"
"0",""
"0","# Fix DC missing in state mapping"
"0","df_corp2$region <- if_else(is.na(df_corp2$region), ""district of columbia"", df_corp2$region)"
"0",""
"0","# Merge with map data"
"0","int_data <- left_join(us_states_sf, df_corp2, by = ""region"")"
"0","## Combined all -- us_states_sf2"
"0",""
"0","### Pivot race wider "
"0",""
"0","int_data <- int_data %>%"
"0","  mutate(across(c(pct_, OSS_), ~ replace_na(.x, 0))) %>%  # Replace NA with 0 in selected columns"
"0","  pivot_wider("
"0","    names_from = race,   # Convert race categories into column names"
"0","    values_from = pct_,  # Values to fill in new columns"
"0","    values_fill = list(pct_ = 0)) # replace na's with 0s"
"0","# Drop geometry column before summarization"
"0","# "
"0","# int_data_clean <- int_data %>%"
"0","#   st_drop_geometry()  # Removes spatial geometry"
"0","# "
"0","# int_data_clean <- int_data_clean %>%"
"0","#   group_by(region) %>%"
"0","#   summarise(Average_Suspensions = mean(total, na.rm = TRUE))"
"0","# "
"0","# int_data <- left_join(int_data_clean, int_data, by = ""region"")"
"0","# "
"0",""
"0",""
"0","long_data <- int_data %>%"
"0","    pivot_longer(cols = c(AI, AS, BL, HI, HP, MR, WH, total), names_to = ""race"", values_to = ""pct_"") %>% "
"0","  group_by(YEAR, race, STATE_CODE)"
"0",""
"0",""
"0",""
"0","# View transformed data"
"0","#head(int_data)"
"0",""
"0","### Interactive map "
"0","output$map <- renderLeaflet({"
"0","  leaflet(int_data, options = leafletOptions(zoomControl = FALSE, dragging = FALSE)) %>%"
"0","    "
"0","    addTiles() %>%"
"0","       "
"0","    # ✅ Set initial view to focus on the U.S."
"0","    setView(lng = -98.5795, lat = 39.8283, zoom = 4) %>%  # Center at U.S. geographic center"
"0","    "
"0","    # ✅ Restrict users from moving outside the U.S."
"0","    fitBounds(lng1 = -125, lat1 = 25, lng2 = -66, lat2 = 50) %>%"
"0","    "
"0","    addPolygons("
"0","      fillColor = ~colorNumeric(""Blues"", int_data$total)(total),"
"0","      color = ""white"","
"0","      weight = 1,"
"0","      fillOpacity = 0.8,"
"0","      highlightOptions = highlightOptions(weight = 3, color = ""#666"", fillOpacity = 0.9),"
"0","      label = ~paste0(region, "": "", round(total, 2), ""% Avg. Overall Suspended""),"
"0","      layerId = ~STATE_CODE  # Use STATE_CODE instead of region"
"0","    )"
"0","})"
"2","Error: object 'output' not found
"
